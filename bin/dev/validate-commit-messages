#!/usr/bin/env bash
set -u
set -o pipefail

trap "exit" INT

source ".medic/_support/cecho.sh"

invalid_commits=()

while read -r line; do
  if [[ $line != "[seed]"* ]]; then
    invalid_commits+=("$line")
  fi
done < <(git log --pretty=format:"%s [%h]")

if [[ ${#invalid_commits[@]} -gt 0 ]]; then
  cecho --bright-bold-red "ERROR" \
    --bright-red "Expected all commits to start with" \
    --bright-yellow "[seed]" \
    --bright-red "but found ${#invalid_commits[@]} that did not:"
  echo ""

  printf '%s\n' "${invalid_commits[@]}"
  echo ""
  exit 1
fi
